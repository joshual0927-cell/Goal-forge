<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Goal-Forge – AI Weekly Planner</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #6B4EFF, #10B981);
      color: white;
      text-align: center;
      padding: 60px 20px;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    h1 { font-size: 3.5rem; margin: 0; }
    p { font-size: 1.3rem; max-width: 600px; margin: 20px auto; }
    .btn {
      background: white; color: #6B4EFF; padding: 16px 32px;
      font-weight: 700; font-size: 1.2rem; border-radius: 12px;
      text-decoration: none; display: inline-block; margin-top: 20px;
    }
    .btn:hover { transform: scale(1.05); }
  </style>
</head>
<body>
  <h1>Goal-Forge</h1>
  <p>Turn “run a marathon” into a weekly plan — and sync it to your calendar in 60 seconds.</p>
  <!-- ==== AI GOAL INPUT FORM ==== -->
<form id="goalForm" style="margin-top: 40px; max-width: 500px; margin-left: auto; margin-right: auto;">
  <textarea 
    id="goalsInput" 
    placeholder='Try:&#10;"Run a 5K in 8 weeks"&#10;"Work 9–5 Mon–Fri"&#10;"Gym 3x/week"&#10;"Sleep 10 PM – 6 AM"' 
    style="width: 100%; height: 140px; padding: 14px; border-radius: 12px; font-size: 1rem; font-family: Inter, sans-serif; margin-bottom: 16px; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.1);" 
    required></textarea>
  <button type="submit" class="btn" style="width: 100%;">Generate My Week</button>
</form>

<div id="result" style="margin-top: 30px; color: white; background: rgba(0,0,0,0.3); padding: 20px; border-radius: 12px; font-family: monospace; display: none; max-height: 400px; overflow-y: auto;"></div>
<div id="syncSection" style="margin-top: 20px; display: none; text-align:center;">
  <button id="syncBtn" class="btn" style="background: #4285F4; color: white; width:100%; max-width:400px;">
    Sync to Google Calendar
  </button>
  <p id="syncStatus" style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8; color:white;"></p>
</div>
<script>
  // Wait for DOM to load
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('goalForm');
    const result = document.getElementById('result');

    if (!form || !result) {
      console.error('Form or result div not found');
      return;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const input = document.getElementById('goalsInput').value.trim();
      if (!input) return;

      result.style.display = 'block';
      result.innerHTML = '<p style="margin:0; opacity:0.8;">Thinking...</p>';

      try {
        const res = await fetch('/api/plan', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ input })
        });

        if (!res.ok) {
          throw new Error(`HTTP ${res.status}`);
        }

        const data = await res.json();
        
        // === RENDER WEEKLY GRID ===
const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
const hours = Array.from({length: 24}, (_, i) => `${i.toString().padStart(2, '0')}:00`);

let gridHTML = `<div style="margin-top:20px; font-family:Inter,sans-serif;">
  <h3 style="margin:0 0 10px; color:white;">${data.week}</h3>
  <div style="display:grid; grid-template-columns: 80px repeat(7, 1fr); gap:5px; font-size:0.85rem;">
    <div></div>`; // Empty corner

// === RENDER WEEKLY GRID (FIXED ALIGNMENT + SPANNING) ===
const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
const hours = Array.from({length: 24}, (_, i) => `${i.toString().padStart(2, '0')}:00`);

let gridHTML = `<div style="margin-top:20px; font-family:Inter,sans-serif;">
  <h3 style="margin:0 0 10px; color:white; font-weight:700;">${data.week}</h3>
  <div style="overflow-x:auto;">
    <div style="display:grid; grid-template-columns: 70px repeat(7, 1fr); gap:4px; font-size:0.85rem; min-width:800px;">
      <div></div>`; // Corner

// Day headers
days.forEach(day => {
  gridHTML += `<div style="text-align:center; font-weight:700; color:#e2e8f0; padding:8px 0; background:rgba(255,255,255,0.1); border-radius:6px;">${day.slice(0,3)}</div>`;
});

// Time rows
hours.forEach((hour, hourIndex) => {
  // Time label (LEFT-ALIGNED)
  gridHTML += `<div style="text-align:left; color:#94a3b8; font-weight:600; padding:2px 0; font-size:0.75rem;">${hour}</div>`;

  days.forEach(day => {
    const event = data.events.find(e => 
      e.day === day && 
      parseInt(e.start.split(':')[0]) === hourIndex
    );

    if (event) {
      const colorMap = { 
        gray: '#64748b', 
        blue: '#3b82f6', 
        teal: '#14b8a6' 
      };
      const bg = colorMap[event.color] || '#6b7280';

      // Calculate rowspan (in hours)
      const startHour = parseInt(event.start.split(':')[0]);
      const endHour = parseInt(event.end.split(':')[0]);
      const rowspan = endHour - startHour;

      gridHTML += `<div style="
        background:${bg}; 
        color:white; 
        padding:6px 8px; 
        border-radius:6px; 
        font-weight:600; 
        grid-row: span ${rowspan};
        display:flex; 
        flex-direction:column; 
        justify-content:center;
        min-height:${rowspan * 24}px;
      ">
        <div style="font-size:0.8rem;">${event.title}</div>
        <div style="font-size:0.7rem; opacity:0.9; margin-top:2px;">${event.start}–${event.end}</div>
      </div>`;
    } else {
      // Empty cell
      gridHTML += `<div style="min-height:24px;"></div>`;
    }
  });
});

gridHTML += `</div></div></div>`;
result.innerHTML = gridHTML;

// SHOW SYNC BUTTON
document.getElementById('syncSection').style.display = 'block';

// SHOW SYNC BUTTON
document.getElementById('syncSection').style.display = 'block';
      } catch (err) {
        console.error('Fetch error:', err);
        result.innerHTML = `<p style="color:#ff6b6b;">Error: ${err.message}. Check if /api/plan is live.</p>`;
      }
    });
  });
</script>
<!-- ==== END AI FORM ==== -->
  <script>
    document.getElementById('waitlist').addEventListener('click', () => {
      alert('Waitlist coming soon! Check back in 24h.');
    });
  </script>
</body>
</html>
